<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calculators</title>
  <!-- Common Header -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="main.css" type="text/css">
  <script src="scripts/theme.js"></script>
</head>

<body>

<pre id="gren"></pre>

<script src="scripts/Main.js"></script>
<script>
try {
  var app = Gren.Main.init({ node: document.getElementById("gren"), flags: document.location.hash });

  var timeoutId = undefined;

  function replaceState(hash) {
    window.history.replaceState({}, "", hash);
    timeoutId = undefined;
  }

  app.ports.changePage.subscribe(function(hash) {
    if (timeoutId != undefined)
      window.clearTimeout(timeoutId);

    window.history.pushState({}, "", hash);
  });

  app.ports.updatePage.subscribe(function(hash) {
    if (timeoutId != undefined)
      window.clearTimeout(timeoutId);

    // Only update in 250ms
    timeoutId = window.setTimeout(replaceState, 250, hash);
  });

  app.ports.copyId.subscribe(function(id) {
    var input = document.getElementById(id);

    input.focus();
    input.select();

    try {
      var successful = document.execCommand("copy");
      if (!successful)
        window.alert("Failed to copy to clipboard");
    } catch (e) {
      window.alert("Failed to copy to clipboard: " + e);
    }
  });

  window.addEventListener("hashchange", function(event) {
    if (timeoutId != undefined)
      window.clearTimeout(timeoutId);

    app.ports.pageChanged.send(document.location.hash);
  })
}
catch (e)
{
  // display initialization errors (e.g. bad flags, infinite recursion)
  var header = document.createElement("h1");
  header.style.fontFamily = "monospace";
  header.innerText = "Initialization Error";
  var pre = document.getElementById("gren");
  document.body.insertBefore(header, pre);
  pre.innerText = e;
  throw e;
}
</script>

</body>
</html>
